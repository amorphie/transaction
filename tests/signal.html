<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            
            .withUrl("http://localhost:5009/transaction", { 
                skipNegotiation: true,
		        transport: signalR.HttpTransportType.WebSockets,
                accessTokenFactory: () => { return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IjQ3ODE5OTcwLTlkNzktNGRkOC05MjgzLWM4YzEwMWE1NWFiYSIsInVzZXIiOiIzODU1MjA2OTAwOCIsInRyYW5zYWN0aW9uSWQiOiI0NzgxOTk3MC05ZDc5LTRkZDgtOTI4My1jOGMxMDFhNTVhYmEiLCJuYmYiOjE2NzA4NjA5NTAsImV4cCI6MTY3MDg5Njk1MCwiaWF0IjoxNjcwODYwOTUwLCJpc3MiOiJodHRwczovL3RyYW5zYWN0aW9uLmFtb3JwaGllLmJ1cmdhbi5jb20udHIvIiwiYXVkIjoiaHR0cHM6Ly90cmFuc2FjdGlvbi5hbW9ycGhpZS5idXJnYW4uY29tLnRyLyJ9.LWctwBpJfUu0G-6skwEVyhV_gxjTlxCZmGdEfQ8CO7s" } })
            .configureLogging(signalR.LogLevel.Trace)
            .build();

        connection.on("messageReceived", (token, message) => {
            console.log(token, message);
        });

        /*
        connection.start(function () {
            
        });
        */

        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected.");
                connection.invoke("newmessage", "ugur", "test message");
            } catch (err) {
                console.log(err);
                setTimeout(start, 5000);
            }
        };



        connection.onclose(async () => {
            await start();
        });

        start();
    </script>
</head>

<body>
</body>

</html>